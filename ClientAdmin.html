<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Friska Admin</title>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#f4f6fb;
}

.header {
  background:#0a1a6e;
  color:white;
  padding:16px;
  font-size:18px;
  font-weight:bold;
  text-align:center;
}

.container {
  padding:15px;
}

.card {
  background:white;
  border-radius:12px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 2px 8px rgba(0,0,0,0.05);
}

input, select {
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border-radius:8px;
  border:1px solid #ddd;
  font-size:14px;
}

.checkbox-row {
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
}

.checkbox-row label {
  font-size:14px;
}

button {
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  font-size:15px;
  font-weight:bold;
}

.primary {
  background:#0a1a6e;
  color:white;
}

.secondary {
  background:#444;
  color:white;
  margin-top:10px;
}

.message {
  margin-top:10px;
  text-align:center;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="header">
  Friska Admin Panel
</div>

<div class="container">

  <div class="card">
    <input id="name" placeholder="Client Name">
    <input id="phone" placeholder="Phone Number">

    <select id="type">
      <option value="">Select Meal Type</option>
      <option value="1 Morning deliver">1 Morning deliver</option>
      <option value="2 Nutri Balance">2 Nutri Balance</option>
      <option value="3 High Protein">3 High Protein</option>
      <option value="4 High Carb">4 High Carb</option>
      <option value="5 Low Carb">5 Low Carb</option>
      <option value="6 No Carb">6 No Carb</option>
      <option value="7 High Fiber">7 High Fiber</option>
      <option value="8 Multi-Category">8 Multi-Category</option>
      <option value="9 Evening Delivery">9 Evening Delivery</option>
    </select>

    <input id="remarks" placeholder="Remarks">
    <input id="location1" placeholder="Location 1">
    <input id="location2" placeholder="Location 2">
    <input id="deliveryPrice" placeholder="Delivery Price">

    <div class="checkbox-row">
      <label><input type="checkbox" id="morning"> Morning</label>
      <label><input type="checkbox" id="afternoon"> Afternoon</label>
      <label><input type="checkbox" id="evening"> Evening</label>
    </div>

    <button id="saveBtn" class="primary">
      Save Client
    </button>

    <button class="secondary" onclick="refreshClients()">Refresh Cache</button>

    <div id="message" class="message"></div>
  </div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxqJwV7OIaibHSLBl7Q8r52qo55i_6B4VksyQIZIw1DjdswvQHBta7PHUNdRquc7yWi/exec";

let isSubmitting = false;

document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("saveBtn")
    .addEventListener("click", addClient);
});

function showMessage(text, error=false){
  const msg = document.getElementById("message");
  msg.style.color = error ? "red" : "green";
  msg.innerText = text;
}

async function addClient(){

  if (isSubmitting) return;

  const saveBtn = document.getElementById("saveBtn");
  const container = document.querySelector(".container");

  // ðŸ”¥ SHOW LOADING IMMEDIATELY
  isSubmitting = true;
  saveBtn.disabled = true;
  saveBtn.innerHTML = `<span class="spinner"></span> Saving...`;
  container.classList.add("loading");

  const data = {
    name: document.getElementById("name").value.trim(),
    phone: document.getElementById("phone").value.trim(),
    type: document.getElementById("type").value,
    remarks: document.getElementById("remarks").value.trim(),
    location1: document.getElementById("location1").value.trim(),
    location2: document.getElementById("location2").value.trim(),
    deliveryPrice: document.getElementById("deliveryPrice").value.trim(),
    morning: document.getElementById("morning").checked,
    afternoon: document.getElementById("afternoon").checked,
    evening: document.getElementById("evening").checked
  };

  if(!data.name || !data.phone){
    resetButton();
    showMessage("Name & Phone required", true);
    return;
  }

  try {

    const res = await fetch(API_URL,{
      method:"POST",
      headers:{"Content-Type":"application/x-www-form-urlencoded"},
      body:new URLSearchParams({
        action:"addClient",
        payload:JSON.stringify(data)
      })
    });

    const result = await res.json();

    if(result.success){
      showMessage("Client Added âœ…");
      clearForm();
    } else {
      showMessage(result.message || "Error", true);
    }

  } catch(err){
    showMessage("Server Error", true);
  }

  resetButton();
}

function resetButton(){
  const saveBtn = document.getElementById("saveBtn");
  const container = document.querySelector(".container");

  isSubmitting = false;
  saveBtn.disabled = false;
  saveBtn.innerHTML = "Save Client";
  container.classList.remove("loading");
}

function clearForm(){
  document.querySelectorAll("input").forEach(i=>{
    if(i.type==="checkbox") i.checked=false;
    else i.value="";
  });
  document.getElementById("type").value="";
}
</script>



</body>
</html>
